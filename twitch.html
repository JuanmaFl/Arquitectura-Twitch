
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twitch ‚Äî Arquitectura de Datos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --purple: #9146FF;
      --purple-dark: #6b2fc0;
      --purple-glow: rgba(145, 70, 255, 0.3);
      --bg: #0e0e10;
      --bg2: #18181b;
      --bg3: #1f1f23;
      --text: #efeff1;
      --muted: #848494;
      --accent: #00e5ff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Syne', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Noise overlay */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
      opacity: 0.6;
    }

    header {
      position: relative;
      z-index: 10;
      padding: 3rem 4rem 2rem;
      border-bottom: 1px solid rgba(145, 70, 255, 0.2);
      display: flex;
      align-items: flex-end;
      gap: 2rem;
    }

    .logo-badge {
      width: 56px; height: 56px;
      background: var(--purple);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 30px var(--purple-glow);
      flex-shrink: 0;
    }

    .logo-badge svg { width: 32px; height: 32px; fill: white; }

    .header-text h1 {
      font-size: 2.4rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1;
    }

    .header-text h1 span { color: var(--purple); }

    .header-text p {
      font-family: 'Space Mono', monospace;
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.4rem;
      letter-spacing: 0.05em;
    }

    .tag {
      margin-left: auto;
      font-family: 'Space Mono', monospace;
      font-size: 0.65rem;
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: 4px;
      padding: 0.25rem 0.6rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Cost banner */
    .cost-banner {
      position: relative; z-index: 10;
      display: flex;
      gap: 1px;
      background: rgba(145, 70, 255, 0.1);
      border-bottom: 1px solid rgba(145, 70, 255, 0.15);
      overflow: hidden;
    }

    .cost-item {
      flex: 1;
      padding: 1rem 1.5rem;
      background: var(--bg2);
      transition: background 0.2s;
      cursor: default;
    }

    .cost-item:hover { background: var(--bg3); }

    .cost-item .label {
      font-family: 'Space Mono', monospace;
      font-size: 0.6rem;
      color: var(--muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.3rem;
    }

    .cost-item .value {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }

    .cost-item .value.dominant { color: var(--purple); font-size: 1.3rem; }
    .cost-item .value.total { color: var(--accent); font-size: 1.2rem; }

    /* Main diagram area */
    main {
      position: relative; z-index: 10;
      padding: 3rem 4rem;
    }

    .section-label {
      font-family: 'Space Mono', monospace;
      font-size: 0.65rem;
      color: var(--purple);
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 1.5rem;
    }

    .diagram-container {
      background: var(--bg2);
      border: 1px solid rgba(145, 70, 255, 0.2);
      border-radius: 16px;
      padding: 2rem;
      overflow-x: auto;
      box-shadow:
        0 0 60px rgba(145, 70, 255, 0.08),
        inset 0 1px 0 rgba(255,255,255,0.04);
    }

    .mermaid {
      display: flex;
      justify-content: center;
    }

    /* Mermaid overrides for dark theme */
    .mermaid svg { max-width: 100%; }

    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-top: 2rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'Space Mono', monospace;
      font-size: 0.65rem;
      color: var(--muted);
      letter-spacing: 0.05em;
    }

    .dot {
      width: 10px; height: 10px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    footer {
      position: relative; z-index: 10;
      padding: 2rem 4rem;
      border-top: 1px solid rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    footer p {
      font-family: 'Space Mono', monospace;
      font-size: 0.6rem;
      color: var(--muted);
      letter-spacing: 0.05em;
    }

    /* Animated background gradient */
    .bg-gradient {
      position: fixed;
      top: -50%;
      left: -20%;
      width: 60%;
      height: 80%;
      background: radial-gradient(ellipse, rgba(145,70,255,0.07) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
      animation: drift 8s ease-in-out infinite alternate;
    }

    @keyframes drift {
      from { transform: translate(0, 0); }
      to   { transform: translate(5%, 8%); }
    }
  </style>
</head>
<body>

<div class="bg-gradient"></div>

<header>
  <div class="logo-badge">
    <!-- Twitch glitch icon -->
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714z"/>
    </svg>
  </div>
  <div class="header-text">
    <h1>Twitch <span>Data Architecture</span></h1>
    <p>// INFRAESTRUCTURA DE DATOS ‚Äî COMPONENTES INTERNOS Y COSTOS ESTIMADOS</p>
  </div>
  <div class="tag">‚¨§ LIVE SYSTEM</div>
</header>

<!-- Cost summary banner -->
<div class="cost-banner">
  <div class="cost-item">
    <div class="label">üöÄ CDN Global</div>
    <div class="value dominant">$100M‚Äì150M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">‚òÅÔ∏è S3 Storage (VODs)</div>
    <div class="value">$25M‚Äì35M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">üé¨ Video Transcoding</div>
    <div class="value">$15M‚Äì20M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">ü§ñ ML Pipeline</div>
    <div class="value">$5M‚Äì8M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">üêï Monitoring (Datadog)</div>
    <div class="value">$5M‚Äì7M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">üîÄ Apache Kafka</div>
    <div class="value">$3M‚Äì5M/a√±o</div>
  </div>
  <div class="cost-item">
    <div class="label">üí° TOTAL ESTIMADO</div>
    <div class="value total">~$160M‚Äì240M/a√±o</div>
  </div>
</div>

<main>
  <div class="section-label">// DIAGRAMA DE ARQUITECTURA COMPLETO</div>

  <div class="diagram-container">
    <div class="mermaid">
flowchart TD
    subgraph SOURCES["üé• FUENTES DE DATOS"]
        S1["üéÆ Streamers\nRTMP / WebRTC"]
        S2["üë• Viewers\nChats & Interacciones"]
        S3["üì± Dispositivos\nM√≥vil / Consolas / Web"]
        S4["üîå API Clients\nTerceros & Extensiones"]
    end

    subgraph INGESTION["‚ö° INGESTA EN TIEMPO REAL"]
        I1["üåê Ingest Edge Nodes\nRTMP Servers\n~1,000+ nodos globales\nüí∞ ~$8M‚Äì12M/a√±o"]
        I2["üí¨ WebSocket Servers\nChat & PubSub System"]
        I3["üì° Event Collectors\nHTTP Endpoints"]
        I4["üîÄ Apache Kafka\nMessage Broker\nMillones de eventos/seg\nüí∞ ~$3M‚Äì5M/a√±o"]
    end

    subgraph PROCESSING["‚öôÔ∏è PROCESAMIENTO & PIPELINES"]
        P1["üé¨ Video Transcoding\nFFmpeg + GPU Clusters\n480p / 720p / 1080p / 4K\nüí∞ ~$15M‚Äì20M/a√±o"]
        P2["‚ö° Apache Flink\nStream Processing\nM√©tricas en tiempo real"]
        P3["üî• Apache Spark\nBatch Processing\nReportes & an√°lisis hist√≥rico"]
        P4["ü§ñ ML Pipeline\nRecomendaciones + Anti-spam\nüí∞ ~$5M‚Äì8M/a√±o"]
        P5["üõ°Ô∏è Trust & Safety\nDetecci√≥n de contenido"]
    end

    subgraph STORAGE["üóÑÔ∏è ALMACENAMIENTO & BASES DE DATOS"]
        DB1[("üêò PostgreSQL\nDatos de usuarios\nMetadata de canales")]
        DB2[("‚ö° Redis Cluster\nSesiones & Cache\nüí∞ ~$2M/a√±o")]
        DB3[("‚òÅÔ∏è Amazon S3\nVODs, clips, assets\nüí∞ ~$25M‚Äì35M/a√±o")]
        DB4[("üìä Vertica / Druid\nAnalytics Warehouse\nConsultas OLAP")]
        DB5[("üîç Elasticsearch\nSearch & logs")]
        DB6[("üåç CockroachDB\nSQL Distribuido Global")]
    end

    subgraph DELIVERY["üåê ENTREGA DE CONTENIDO"]
        D1["üöÄ CDN Global\nAkamai + CloudFront\nüí∞ ~$100M‚Äì150M/a√±o"]
        D2["üì∫ HLS / DASH\nAdaptive Bitrate ~3s latency"]
        D3["üîó API Gateway\nREST & GraphQL + OAuth2"]
    end

    subgraph OBSERVABILITY["üìä OBSERVABILIDAD"]
        M1["üìà Prometheus + Grafana\nM√©tricas de infraestructura"]
        M2["üêï Datadog\nAPM & Alertas\nüí∞ ~$5M‚Äì7M/a√±o"]
        M3["üî≠ Jaeger\nDistributed Tracing"]
    end

    S1 -->|"Stream RTMP"| I1
    S2 -->|"WS / HTTP"| I2
    S2 -->|"Eventos"| I3
    S3 -->|"Multi-protocolo"| I1
    S3 -->|"Interacciones"| I2
    S4 -->|"REST / EventSub"| I3

    I1 -->|"Video chunks"| I4
    I2 -->|"Mensajes"| I4
    I3 -->|"Eventos anal√≠tica"| I4

    I4 -->|"Video stream"| P1
    I4 -->|"Stream events"| P2
    I4 -->|"User events"| P4
    I4 -->|"Reportes"| P3

    P1 -->|"VODs y segmentos"| DB3
    P2 -->|"M√©tricas tiempo real"| DB4
    P3 -->|"Datos hist√≥ricos"| DB4
    P4 -->|"Modelos & scores"| DB2
    P5 -->|"Logs de moderaci√≥n"| DB5
    P2 -->|"Sesiones activas"| DB2

    DB3 -->|"Contenido de video"| D1
    DB1 -->|"Perfil & datos"| D3
    DB2 -->|"Cache de respuestas"| D3
    DB6 -->|"Consistencia global"| D3
    P1 -->|"Segmentos HLS"| D2
    D2 -->|"Manifiestos"| D1

    PROCESSING -.->|"m√©tricas"| M1
    DELIVERY -.->|"m√©tricas"| M2
    INGESTION -.->|"trazas"| M3

    classDef sources fill:#9b59b6,color:#fff,stroke:#7d3c98,stroke-width:2px
    classDef ingestion fill:#2471a3,color:#fff,stroke:#1a5276,stroke-width:2px
    classDef processing fill:#1e8449,color:#fff,stroke:#145a32,stroke-width:2px
    classDef storage fill:#d35400,color:#fff,stroke:#a04000,stroke-width:2px
    classDef delivery fill:#c0392b,color:#fff,stroke:#922b21,stroke-width:2px
    classDef monitoring fill:#616a6b,color:#fff,stroke:#424949,stroke-width:2px

    class S1,S2,S3,S4 sources
    class I1,I2,I3,I4 ingestion
    class P1,P2,P3,P4,P5 processing
    class DB1,DB2,DB3,DB4,DB5,DB6 storage
    class D1,D2,D3 delivery
    class M1,M2,M3 monitoring
    </div>
  </div>

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item"><div class="dot" style="background:#9b59b6"></div> Fuentes de datos</div>
    <div class="legend-item"><div class="dot" style="background:#2471a3"></div> Ingesta tiempo real</div>
    <div class="legend-item"><div class="dot" style="background:#1e8449"></div> Procesamiento / Pipelines</div>
    <div class="legend-item"><div class="dot" style="background:#d35400"></div> Almacenamiento & DBs</div>
    <div class="legend-item"><div class="dot" style="background:#c0392b"></div> Entrega de contenido (CDN)</div>
    <div class="legend-item"><div class="dot" style="background:#616a6b"></div> Observabilidad</div>
    <div class="legend-item" style="margin-left:auto;"><div class="dot" style="background:#9146FF"></div> üí∞ = costo estimado anual</div>
  </div>
</main>

<footer>
  <p>// TWITCH INFRASTRUCTURE ‚Äî ESTIMATED COSTS 2024 ‚Äî BASED ON PUBLIC REPORTS & INDUSTRY ANALYSIS</p>
  <p>NOTE: Valores aproximados. CDN = principal centro de costo (~60‚Äì65% del total)</p>
</footer>

<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      darkMode: true,
      background: '#18181b',
      primaryColor: '#9146FF',
      primaryTextColor: '#efeff1',
      primaryBorderColor: '#6b2fc0',
      lineColor: '#848494',
      secondaryColor: '#1f1f23',
      tertiaryColor: '#0e0e10',
      clusterBkg: '#1f1f23',
      clusterBorder: '#9146FF',
      edgeLabelBackground: '#18181b',
      fontSize: '13px'
    },
    flowchart: {
      curve: 'basis',
      padding: 20
    }
  });
</script>
</body>
</html>
